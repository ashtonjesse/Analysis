close all;
clear all;
% % % open all the files 
% aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh006\Pressure.mat' ...
%     };
% aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh006\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814CCh007\Pressure.mat' ...
%     };
aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh001\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh002\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh004\Pressure.mat' ...
    };
% aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828CCh006\Pressure.mat' ...
%     };

% aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813CCh004\Pressure.mat' ...
%     };
% aFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821CCh004\Pressure.mat' ...
%     };


aPressureData = cell(1,numel(aFiles));
for i = 1:numel(aFiles)
    aPressureData{i} = GetPressureFromMATFile(Pressure,char(aFiles{i}),'Optical');
    fprintf('Got file %s\n',char(aFiles{i}));
end

%loop through the files and get the data for plotting
aRates = cell(numel(aFiles),1);
aTimes = cell(numel(aFiles),1);
oFigure = figure(); oAxes = axes();
oColours = zeros(numel(aFiles),3);%distinguishable_colors(numel(aFiles));
oColours(2,1) = 1;oColours(3,2) = 1;oColours(4,3) = 1;
for i = 1:numel(aFiles)
    oPressure = aPressureData{i};
    sFile = char(aFiles{i});
    aIndices = regexp(sFile,'\');
    sName = sFile(aIndices(end-1)+1:aIndices(end)-1);
    if isfield(oPressure.oPhrenic.Electrodes.Processed,'BeatRates') 
        aRates{i} = oPressure.oPhrenic.Electrodes.Processed.BeatRates';
        aTimes{i} = oPressure.oPhrenic.Electrodes.Processed.BeatRateTimes(2:end);
        oPlot = plot(oAxes,aTimes{i},aRates{i}, 'Color',oColours(i,:));
        hold(oAxes,'on');
        set(oPlot,'displayname',sName);
    else
        aRates{i} = cell(numel(oPressure.oRecording),1);
        aTimes{i} = cell(numel(oPressure.oRecording),1);
        for j = 1:numel(oPressure.oRecording)
            aRates{i}{j} = oPressure.oRecording(j).Electrodes.Processed.BeatRates';
            aTimes{i}{j} = oPressure.oRecording(j).Electrodes.Processed.BeatRateTimes(2:end);
            oPlot = plot(oAxes,aTimes{i}{j},aRates{i}{j}, 'Color',oColours(i,:));
            hold(oAxes,'on');
            set(oPlot,'displayname',sName);
        end
    end
end
hold(oAxes,'off');
legend(oAxes,'show');

