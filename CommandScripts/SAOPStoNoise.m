close all;
clear all;
% load all the data files as these contain the optical signal data
aDataFiles = {...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro001\baro001a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro002\baro002a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro003\baro003a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro004\baro004a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro005\baro005a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro006\baro006a_3x3_1ms_g10_LP100Hz-waveEach.mat' ...
    };
aChannels = [341 342 343	344	345	346	347	348	349	350	351	352	353	354	373	374	375	376	377	378	379	380	381	382	383	384	385	386	406	407 ...
    408	409	410	411	412	413	414	415	416	417	418	419	440	441	442	443	444	445	446	447	448	449	450	451	452	453	474	475	476	477	478	479	480	...
    481	482	483	484	485	486	487	509	510	511	512	513	514	515	516	517	518	519	520	521	522	545	546	547	548	549	550	551	552	553	554	555	556	...
    557	558	582	583	584	585	586	587	588	589	590	591	592	593	594	595	620	621	622	623	624	625	626	627	628	629	630	631	632	633	659	660	661	...
    662	663	664	665	666	667	668	669	670	671	672	698	699	700	701	702	703	704	705	706	707	708	709	710	711	737	738	739	740	741	742	743	744	...
    745	746	747	748	749	750	776	777	778	779	780	781	782	783	784	785	786	787	788	789	815	816	817	818	819	820	821	822	823	824	825	826	827	...
    828	854	855	856	857	858	859	860	861	862	863	864	865	866	867];

%initialise variables
aSignaltoNoise = zeros(numel(aDataFiles),numel(aChannels));
% % % %loop through the recordings
iBase = 15;
for m = 1:numel(aDataFiles)
    %get this optical data
    oOptical = GetOpticalFromMATFile(Optical,aDataFiles{m});
    %get beat indexes for particular beat
    aBeatIndexes = oOptical.Beats.Indexes(4,:);
    
    %get the data for this beat
    aData = MultiLevelSubsRef(oOptical.oDAL.oHelper,oOptical.Electrodes,'Processed','Data');
%     aSlope = MultiLevelSubsRef(oOptical.oDAL.oHelper,oOptical.Electrodes,'Processed','Slope');
    aBeatData = aData(aBeatIndexes(1):aBeatIndexes(2),aChannels);
%     aBeatSlope = aSlope(aBeatIndexes(1):aBeatIndexes(2),aChannels);
    aPeak = max(aBeatData,[],1)-mean(aBeatData(1:iBase,:),1);
    dNoise = std(aBeatData(1:iBase,:),[],1);
    aSignaltoNoise(m,:) = aPeak/dNoise;
    fprintf('Done file %s\n',aDataFiles{m});
end
aMeans = mean(aSignaltoNoise,2);
aSEM = std(aSignaltoNoise,[],2);
errorbar(1:m,aMeans,aSEM);