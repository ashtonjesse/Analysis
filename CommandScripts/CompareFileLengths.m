% % % % load all the pressure files and compare the processed data to the length
% % % % of the average wave
close all;

aControlPressureFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro002\Pressure.mat', ...
        'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro004\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro007\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro007\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro008\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro009\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro010\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro011\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro012\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro001\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro002\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro004\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro008\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro009\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro010\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro001\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro002\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro004\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro007\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro008\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro009\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro001\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro002\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro004\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro007\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro008\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro009\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro010\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro001\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro002\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro003\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro004\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro005\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro006\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro007\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro008\Pressure.mat', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro009\Pressure.mat'...
    };

aControlOpticalFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro002\baro002_g10_LP100Hz-wave.csv', ...
        'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro003\baro003_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro004\baro004_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro005\baro005_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro006\baro006_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140612\20140612baro007\baro007_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro005\baro005_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro006\baro006_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro007\baro007_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro008\baro008_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro009\baro009_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro010\baro010_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro011\baro011_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140703\20140703baro012\baro012_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro001\baro001_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro002\baro002_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro003\baro003_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro004\baro004_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro005\baro005_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro006\baro006_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro008\baro008_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro009\baro009_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140715\20140715baro010\baro010_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro001\baro001_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro002\baro002_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro003\baro003_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro004\baro004_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro005\baro005_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro006\baro006_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro007\baro007_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro008\baro008_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140718\20140718baro009\baro009_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro001\baro001_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro002\baro002_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro003\baro003_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro004\baro004_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro005\baro005_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro006\baro006_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro007\baro007_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro008\baro008_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro009\baro009_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140722\20140722baro010\baro010_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro001\baro001_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro002\baro002_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro003\baro003_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro004\baro004_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro005\baro005_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro006\baro006_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro007\baro007_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro008\baro008_3x3_1ms_7x_g10_LP100Hz-wave.csv', ...
    'G:\PhD\Experiments\Auckland\InSituPrep\20140723\20140723baro009\baro009_3x3_1ms_7x_g10_LP100Hz-wave.csv'...
    };

% aControlPressureFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro003\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro001\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro002\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro003\Pressure.mat' ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro006\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro007\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro006\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro006\Pressure.mat', ... 
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro004\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro005\Pressure.mat', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro006\Pressure.mat' ...
%     };

% aControlOpticalFiles = {'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro003\baro003a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro004\baro004a_3x3_1ms_g10_LP100Hz-avrgwave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro001\baro001a_3x3_1ms_g10_LP100Hz-avrgwave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro002\baro002a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro003\baro003a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro001\baro001a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro002\baro002a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro003\baro003a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro001\baro001a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro002\baro002a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro003\baro003a_3x3_1ms_g10_LP100Hz-wave.csv' ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro005\baro005a_3x3_1ms_g10_LP100Hz-avrgwave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro006\baro006a_3x3_1ms_g10_LP100Hz-avrgwave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140813\20140813baro007\baro007a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro004\baro004a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro005\baro005a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140814\20140814baro006\baro006a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro004\baro004a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro005\baro005a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140821\20140821baro006\baro006a_3x3_1ms_g10_LP100Hz-wave.csv', ... 
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro004\baro004a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro005\baro005a_3x3_1ms_g10_LP100Hz-wave.csv', ...
%     'G:\PhD\Experiments\Auckland\InSituPrep\20140828\20140828baro006\baro006a_3x3_1ms_g10_LP100Hz-wave.csv' ...
%     };


% aControlPressureData = cell(numel(aControlPressureFiles),1);
% for i = 1:numel(aControlPressureData)
%     aControlPressureData{i} = GetPressureFromMATFile(Pressure,char(aControlPressureFiles{i}),'Optical');
%     fprintf('Got pressure file %s\n',char(aControlPressureFiles{i}));
% end
% 
% aControlOpticalData = cell(numel(aControlOpticalFiles),1);
% for i = 1:numel(aControlOpticalData)
%     aControlOpticalData{i} = GetOpticalRecordingFromCSVFile(Optical, char(aControlOpticalFiles{i}), aControlPressureData{i}.oExperiment,6);
%     fprintf('Got optical file %s\n',char(aControlOpticalFiles{i}));
% end

% bDifferences = zeros(numel(aControlPressureData),1);
% for i = 1:numel(aControlPressureData)
%     if numel(aControlOpticalData{i}.Electrodes.Potential.Data) ~= numel(aControlPressureData{i}.oRecording(1).Electrodes.Processed.Data)
%         bDifferences(i) = numel(aControlOpticalData{i}.Electrodes.Potential.Data) - numel(aControlPressureData{i}.oRecording(1).Electrodes.Processed.Data);
%         figure();
%         plot(aControlOpticalData{i}.TimeSeries,aControlOpticalData{i}.Electrodes.Potential.Data,'k');
%         hold on;
%         for j = 1:size(aControlPressureData{i}.oRecording(1).Electrodes.Processed.BeatIndexes,1)
%             plot(aControlOpticalData{i}.TimeSeries(aControlPressureData{i}.oRecording(1).Electrodes.Processed.BeatIndexes(j,1)+bDifferences(i):...
%                 aControlPressureData{i}.oRecording(1).Electrodes.Processed.BeatIndexes(j,2)+bDifferences(i)),...
%                 aControlOpticalData{i}.Electrodes.Potential.Data(aControlPressureData{i}.oRecording(1).Electrodes.Processed.BeatIndexes(j,1)+bDifferences(i):...
%                 aControlPressureData{i}.oRecording(1).Electrodes.Processed.BeatIndexes(j,2)+bDifferences(i)),'g');
%         end
%         hold off;
%     end
% end
iIndex = 26;
aSelectedOpticalData = aControlOpticalData(logical(bDifferences));
aSelectedPressureData = aControlPressureData(logical(bDifferences));
aSelectedDifferences = bDifferences(logical(bDifferences));
aData = aSelectedOpticalData(iIndex);
aPressure = aSelectedPressureData(iIndex);
iIncrement = aSelectedDifferences(iIndex) - 70;

figure();
plot(aData{1}.TimeSeries,aData{1}.Electrodes.Potential.Data,'k');
hold on;
for j = 1:size(aPressure{1}.oRecording(1).Electrodes.Processed.BeatIndexes,1)
    plot(aData{1}.TimeSeries(aPressure{1}.oRecording(1).Electrodes.Processed.BeatIndexes(j,1)+iIncrement:...
        aPressure{1}.oRecording(1).Electrodes.Processed.BeatIndexes(j,2)+iIncrement),...
        aData{1}.Electrodes.Potential.Data(aPressure{1}.oRecording(1).Electrodes.Processed.BeatIndexes(j,1)+iIncrement:...
        aPressure{1}.oRecording(1).Electrodes.Processed.BeatIndexes(j,2)+iIncrement),'g');
end
hold off;
